<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>程式柴 CodeShiba</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="程式柴 CodeShiba"><meta name="msapplication-TileImage" content="/img/favicon.ico"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="程式柴 CodeShiba"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="目錄 Chapter 1: Hello, World! Chapter 2: Templates Chapter 3: Web Forms Chapter 4: Database Chapter 5: User Logins Chapter 6: Profile Page and Avatars Chapter 7: Error Handling Chapter 8: Followers Chap"><meta property="og:type" content="website"><meta property="og:title" content="程式柴 CodeShiba"><meta property="og:url" content="https://codeshiba.com/python/flask-mega-tutorial/chapter_19_deployment_on_docker_containers.html"><meta property="og:site_name" content="程式柴 CodeShiba"><meta property="og:description" content="目錄 Chapter 1: Hello, World! Chapter 2: Templates Chapter 3: Web Forms Chapter 4: Database Chapter 5: User Logins Chapter 6: Profile Page and Avatars Chapter 7: Error Handling Chapter 8: Followers Chap"><meta property="og:locale" content="zh_TW"><meta property="og:image" content="https://codeshiba.com/img/og_image.png"><meta property="article:published_time" content="2024-02-24T23:25:41.787Z"><meta property="article:modified_time" content="2024-02-24T23:25:41.787Z"><meta property="article:author" content="Luka Huang"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://codeshiba.com/python/flask-mega-tutorial/chapter_19_deployment_on_docker_containers.html"},"headline":"程式柴 CodeShiba","image":["https://codeshiba.com/img/og_image.png"],"datePublished":"2024-02-24T23:25:41.787Z","dateModified":"2024-02-24T23:25:41.787Z","author":{"@type":"Person","name":"Luka Huang"},"publisher":{"@type":"Organization","name":"程式柴 CodeShiba","logo":{"@type":"ImageObject","url":{"text":"程式柴 CodeShiba"}}},"description":"目錄 Chapter 1: Hello, World! Chapter 2: Templates Chapter 3: Web Forms Chapter 4: Database Chapter 5: User Logins Chapter 6: Profile Page and Avatars Chapter 7: Error Handling Chapter 8: Followers Chap"}</script><link rel="canonical" href="https://codeshiba.com/python/flask-mega-tutorial/chapter_19_deployment_on_docker_containers.html"><link rel="icon" href="/img/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/monokai.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=417968703" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', '417968703');</script><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="程式柴 CodeShiba" type="application/atom+xml">
</head><body class="is-2-column" id=""><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/">程式柴 CodeShiba</a></div><div class="navbar-menu"><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="饅頭計畫" href="/bootcamp">饅頭計畫</a><a class="navbar-item" target="_blank" rel="noopener" title="Youtube" href="https://www.youtube.com/channel/UCDOlnOIq5EjQt1ikKhs4XZg"><i class="fab fa-youtube"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目錄" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜尋" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-9-tablet is-9-desktop is-9-widescreen"><div class="card"><article class="card-content article" role="article"><div class="content"><h3 id="目錄"><a href="#目錄" class="headerlink" title="目錄"></a>目錄</h3><ul>
<li><a href="/python/flask-mega-tutorial/chapter_1_hello_world">Chapter 1: Hello, World!</a></li>
<li><a href="/python/flask-mega-tutorial/chapter_2_templates">Chapter 2: Templates</a></li>
<li><a href="/python/flask-mega-tutorial/chapter_3_web_forms">Chapter 3: Web Forms</a></li>
<li><a href="/python/flask-mega-tutorial/chapter_4_database">Chapter 4: Database</a></li>
<li><a href="/python/flask-mega-tutorial/chapter_5_user_logins">Chapter 5: User Logins</a></li>
<li><a href="/python/flask-mega-tutorial/chapter_6_profile_page_and_avatars">Chapter 6: Profile Page and Avatars</a></li>
<li><a href="/python/flask-mega-tutorial/chapter_7_error_handling">Chapter 7: Error Handling</a></li>
<li><a href="/python/flask-mega-tutorial/chapter_8_followers">Chapter 8: Followers</a></li>
<li><a href="/python/flask-mega-tutorial/chapter_9_pagination">Chapter 9: Pagination</a></li>
<li><a href="/python/flask-mega-tutorial/chapter_10_email_support">Chapter 10: Email Support</a></li>
<li><a href="/python/flask-mega-tutorial/chapter_11_facelift">Chapter 11: Facelift</a></li>
<li><a href="/python/flask-mega-tutorial/chapter_12_dates_and_times">Chapter 12: Dates and Times</a></li>
<li><a href="/python/flask-mega-tutorial/chapter_13_i18n_and_l10n">Chapter 13: I18n and L10n</a></li>
<li><a href="/python/flask-mega-tutorial/chapter_14_ajax">Chapter 14: Ajax</a></li>
<li><a href="/python/flask-mega-tutorial/chapter_15_a_better_application_structure">Chapter 15: A Better Application Structure</a></li>
<li><a href="/python/flask-mega-tutorial/chapter_16_full_text_search">Chapter 16: Full-Text Search</a></li>
<li><a href="/python/flask-mega-tutorial/chapter_17_deployment_on_linux">Chapter 17: Deployment on Linux</a></li>
<li><a href="/python/flask-mega-tutorial/chapter_19_deployment_on_docker_containers">Chapter 19: Deployment on Docker Containers</a></li>
<li><a href="/python/flask-mega-tutorial/chapter_20_some_javascript_magic">Chapter 20: Some JavaScript Magic</a></li>
<li><a href="/python/flask-mega-tutorial/chapter_21_user_notifications">Chapter 21: User Notifications</a></li>
<li><a href="/python/flask-mega-tutorial/chapter_22_background_jobs">Chapter 22: Background Jobs</a></li>
<li><a href="/python/flask-mega-tutorial/chapter_23_application_programming_interfaces_apis">Chapter 23: Application Programming Interfaces （APIs）</a></li>
</ul>
<h1 id="Flask-大教程，第十九部分：在-Docker-容器上部署"><a href="#Flask-大教程，第十九部分：在-Docker-容器上部署" class="headerlink" title="Flask 大教程，第十九部分：在 Docker 容器上部署"></a>Flask 大教程，第十九部分：在 Docker 容器上部署</h1><p>這是 Flask 大教程系列的第十九篇文章，在這篇文章中，我將會將 Microblog 部署到 Docker 容器平台上。</p>
<p>在第十七章，你學到了傳統部署的方法，這種方法需要你自己處理伺服器配置的每一個細節。然後在第十八章中，我引導你了解到另一個極端，我介紹了 Heroku 這個服務，它完全控制了配置和部署任務，讓你可以完全專注於你的應用程式。在這一章，你將學習到基於容器的第三種應用程式部署策略，特別是基於 Docker 容器平台。這第三個選項在部署工作所需的努力上介於其他兩者之間。</p>
<p>容器建立在一種輕量級虛擬化技術之上，允許應用程式連同其依賴和配置在完全隔離的環境中運行，但不需要使用如虛擬機這樣的完整虛擬化解決方案，這會需要更多資源並有時會與主機相比有顯著的性能下降。配置為容器主機的系統可以執行許多容器，所有這些容器都共享主機的核心和直接訪問主機的硬體。這與虛擬機形成對比，虛擬機需要模擬完整的系統，包括 CPU、硬盤、其他硬體、核心等。</p>
<p>儘管需要共享核心，容器中的隔離程度相當高。一個容器有其自己的檔案系統，並可以基於與容器主機使用的作業系統不同的作業系統。例如，你可以在 Fedora 主機上運行基於 Ubuntu Linux 的容器，反之亦然。雖然容器是 Linux 作業系統的原生技術，但得益於虛擬化，也可以在 Windows 和 macOS 主機上運行 Linux 容器。這允許你在開發系統上測試你的部署，並且如果你願意，也可以將容器納入你的開發工作流程。</p>
<h2 id="安裝-Docker"><a href="#安裝-Docker" class="headerlink" title="安裝 Docker"></a>安裝 Docker</h2><p>雖然 Docker 不是唯一的容器平台，但它是迄今為止最受歡迎的，所以這將是我的選擇。</p>
<p>要使用 Docker，你首先需要在你的系統上安裝它。Docker 網站提供了 Windows、macOS 和幾個 Linux 發行版的安裝程式。到目前為止，在你的電腦上設置 Docker 最簡單的方法是使用你的作業系統的 Docker Desktop 安裝程式。如果你在 Microsoft Windows 系統上工作，重要的是要注意 Docker 需要 Hyper-V。如果需要，安裝程式將為你啟動這一功能，但請記住，啟動 Hyper-V 可能會阻止其他虛擬化技術如 VirtualBox 的工作。</p>
<p>一旦在你的系統上安裝了 Docker Desktop，你可以通過在終端視</p>
<p>窗或命令提示符上輸入以下命令來驗證安裝是否成功：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ docker version<br></code></pre></td></tr></table></figure>

<h2 id="建立容器映像"><a href="#建立容器映像" class="headerlink" title="建立容器映像"></a>建立容器映像</h2><p>為 Microblog 建立容器的第一步是為它建立一個映像。容器映像是用來建立容器的模板。它包含了容器檔案系統的完整表示，以及關於網絡、啟動選項等的各種設置。</p>
<p>最基本的建立應用程式容器映像的方式是啟動一個你想要使用的基本作業系統（如 Ubuntu、Fedora 等）的容器，連接到在其中運行的 bash shell 程序，然後手動安裝你的應用程式，也許遵循我在第十七章為傳統部署提供的指南。安裝完所有東西後，你可以對容器進行快照，那就成了映像。這種工作流程支持使用 docker 命令，但我不打算討論它，因為每次需要生成新映像時都要手動安裝應用程式並不方便。</p>
<p>更好的方法是通過腳本生成容器映像。建立腳本化容器映像的命令是 docker build。這個命令從一個稱為 Dockerfile 的檔案中讀取並執行建構指令，我將需要建立這個檔案。Dockerfile 基本上是一個安裝程式腳本，執行安裝步驟來部署應用程式，加上一些特定於容器的設置。</p>
<p>這裡是一個為 Microblog 準備的基本 Dockerfile：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs Dockerfile"><span class="hljs-keyword">FROM</span> python:slim<br><br><span class="hljs-keyword">COPY</span><span class="bash"> requirements.txt requirements.txt</span><br><span class="hljs-keyword">RUN</span><span class="bash"> pip install -r requirements.txt</span><br><span class="hljs-keyword">RUN</span><span class="bash"> pip install gunicorn</span><br><br><span class="hljs-keyword">COPY</span><span class="bash"> app app</span><br><span class="hljs-keyword">COPY</span><span class="bash"> migrations migrations</span><br><span class="hljs-keyword">COPY</span><span class="bash"> microblog.py config.py boot.sh ./</span><br><span class="hljs-keyword">RUN</span><span class="bash"> chmod a+x boot.sh</span><br><br><span class="hljs-keyword">ENV</span> FLASK_APP microblog.py<br><span class="hljs-keyword">RUN</span><span class="bash"> flask translate compile</span><br><br><span class="hljs-keyword">EXPOSE</span> <span class="hljs-number">5000</span><br><span class="hljs-keyword">ENTRYPOINT</span><span class="bash"> [<span class="hljs-string">&quot;./boot.sh&quot;</span>]</span><br></code></pre></td></tr></table></figure>

<p>Dockerfile 中的每一行都是一個命令。<code>FROM</code> 命令指定了新映像將建立在哪個基本容器映像之上。思路是從一個現有的映像開始，添加或更改一些東西，最終得到一個衍生的映像。映像通過名稱和標籤來引用，用冒號分隔。標籤用作版本控制機制，允許容器映像提供多於一個變體。我選擇的映像名稱是 python，這是 Python 的官方 Docker 映像。標籤允許你指定解釋器版本和基本作業系統。<code>slim</code> 標籤選擇了只包含運行 Python 解釋器所需最小套件的容器映像。你可以在 Python 映像庫中看到 Python 的其他可用標籤。</p>
<h2 id="啟動容器"><a href="#啟動容器" class="headerlink" title="啟動容器"></a>啟動容器</h2><p>已經建立了映像，你現在可以運行應用程式的容器版本了。這是用 docker run 命令完成的，該命令接受一長串參數。我將從顯示一個基本示例開始：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ docker run --name microblog -d -p 8000:5000 --rm microblog:latest<br></code></pre></td></tr></table></figure>

<p>如果</p>
<p>你想查看哪些容器正在運行，你可以使用 docker ps 命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ docker ps<br></code></pre></td></tr></table></figure>

<p>如果現在你想停止容器，你可以使用 docker stop 並傳遞容器 ID 或者是用 –name 選項給它的名字：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ docker stop microblog<br></code></pre></td></tr></table></figure>

<h2 id="使用第三方「容器化」服務"><a href="#使用第三方「容器化」服務" class="headerlink" title="使用第三方「容器化」服務"></a>使用第三方「容器化」服務</h2><p>Microblog 的容器版本看起來不錯，但我還沒有真正考慮過儲存問題。實際上，由於我沒有設定 DATABASE_URL 環境變數，應用程式正在使用預設的 SQLite 資料庫，這由磁碟上的一個檔案支持。當你停止並刪除容器時，你認為那個 SQLite 檔案會發生什麼？檔案會消失！</p>
<p>容器中的檔案系統是短暫的，意味著當容器消失時，它也會消失。你可以向檔案系統寫入資料，如果容器需要讀取它，資料就會在那裡，但如果由於任何原因你需要回收你的容器並用一個新的替換它，任何應用程式儲存到磁碟上的資料都將永遠丟失。</p>
<h2 id="部署容器化應用程式"><a href="#部署容器化應用程式" class="headerlink" title="部署容器化應用程式"></a>部署容器化應用程式</h2><p>關於在 Docker 容器中運行你的應用程式的最好事情之一是，一旦你在本地測試了容器，你就可以將它們帶到任何提供 Docker 支持的平台。例如，你可以使用我在第十七章推薦的 Digital Ocean、Linode 或 Amazon Lightsail 的相同伺服器。即使是這些提供商中最便宜的產品也足以運行 Docker 和少數幾個容器。</p>
<p>Amazon 容器服務（ECS）為你提供了在完全集成的 AWS 環境中建立容器主機集群並在其上運行容器的能力，支持擴展和負載平衡，還有使用私有容器註冊表為你的容器映像的選項。</p>
<p>最後，如 Kubernetes 這樣的容器編排平台提供了更高層次的自動化和便利，通過允許你以 YAML 格式的文本檔案描述你的多容器部署，具有負載平衡、擴展、安全管理秘密以及滾動升級和回滾的功能。</p>
<p>繼續到下一章。</p>
</div></article></div><div class="card"><div class="card-content"><div id="mc_embed_signup"><form class="validate" action="https://gmail.us20.list-manage.com/subscribe/post?u=669fab1d59a1d7c3ed727d0f0&amp;amp;id=828d363a35" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" target="_blank" novalidate><div id="mc_embed_signup_scroll"><h2>歡迎訂閱，獲取最新資訊、教學文章，一起變強。</h2><div class="mc-field-group"><input class="required email" type="email" placeholder="請輸入 EMAIL" value="" name="EMAIL" id="mce-EMAIL"></div><div class="clear" id="mce-responses"><div class="response" id="mce-error-response" style="display:none"></div><div class="response" id="mce-success-response" style="display:none"></div></div><div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_fb08e7e4c12d83430b6e6d529_bc712ae0b8" tabindex="-1" value=""></div><div class="clear"><input class="button" type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe"></div></div></form></div></div></div><div class="card"><div class="card-content"><h3 class="title is-5">評論</h3><script src="https://utteranc.es/client.js" repo="LukaHuang/codeshiba.com" issue-term="pathname" label="utterances" theme="github-light" crossorigin="anonymous" async></script></div></div></div><!--!--><div class="column column-right is-3-tablet is-3-desktop is-3-widescreen  order-3"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目錄</h3><ul class="menu-list"><ul class="menu-list"><ul class="menu-list"><li><a class="level is-mobile" href="#目錄"><span class="level-left"><span class="level-item">1.1.1</span><span class="level-item">目錄</span></span></a></li></ul></ul><li><a class="level is-mobile" href="#Flask-大教程，第十九部分：在-Docker-容器上部署"><span class="level-left"><span class="level-item">2</span><span class="level-item">Flask 大教程，第十九部分：在 Docker 容器上部署</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#安裝-Docker"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">安裝 Docker</span></span></a></li><li><a class="level is-mobile" href="#建立容器映像"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">建立容器映像</span></span></a></li><li><a class="level is-mobile" href="#啟動容器"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">啟動容器</span></span></a></li><li><a class="level is-mobile" href="#使用第三方「容器化」服務"><span class="level-left"><span class="level-item">2.4</span><span class="level-item">使用第三方「容器化」服務</span></span></a></li><li><a class="level is-mobile" href="#部署容器化應用程式"><span class="level-left"><span class="level-item">2.5</span><span class="level-item">部署容器化應用程式</span></span></a></li></ul></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><p class="is-size-7"><span>&copy; 2024 Luka Huang</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("zh-TW");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: false,
                    fold: ''
                }
            }
        };</script><script src="/js/column.js"></script><a id="back-to-top" title="回到頁首" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="請輸入關鍵字..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"請輸入關鍵字...","untitled":"(無標題)","posts":"文章","pages":"頁面","categories":"文章分類","tags":"標籤"});
        });</script>
        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 30,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(r){r.imageLazyLoadSetting.processImages=t;var e=r.imageLazyLoadSetting.isSPA,n=r.imageLazyLoadSetting.preloadRatio||1,c=a();function a(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(){e&&(c=a());for(var t,o=0;o<c.length;o++)0<=(t=(t=c[o]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(r.innerHeight*n||document.documentElement.clientHeight*n)&&function(){var t,e,n,a,i=c[o];e=function(){c=c.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(n=new Image,a=t.getAttribute("data-original"),n.onload=function(){t.src=a,t.removeAttribute("data-original"),e&&e()},t.src!==a&&(n.src=a))}()}function i(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",i),r.addEventListener("resize",i),r.addEventListener("orientationchange",i)}(this);</script></body></html>